<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Gallery</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="min-h-full w-full bg-white p-4 md:p-6">
    <div id="app"></div>
    <script>
        const productsData = [
            {
                id: 1,
                name: "Classic Leather Sneakers",
                variants: [
                    {
                        id: 1,
                        name: "White",
                        images: [
                            { url: "https://images.unsplash.com/photo-1600269452121-4f2416e55c28?ixlib=rb-4.0.3", alt: "White sneaker front view" },
                            { url: "https://images.unsplash.com/photo-1595950653106-6c9ebd614d3a?ixlib=rb-4.0.3", alt: "White sneaker side view" },
                            { url: "https://images.unsplash.com/photo-1603808033192-082d6919d3e1?ixlib=rb-4.0.3", alt: "White sneaker back view" }
                        ],
                        affiliateLinks: [{
      name: "Amazon",
      logo: "https://upload.wikimedia.org/wikipedia/commons/4/4a/Amazon_icon.svg",
      url: "#",
      price: "$99.99",
      rating: {
        score: 4.5,
        totalReviews: 2543
      },
      delivery: {
        type: "Prime",
        estimatedDays: "2-3 days",
        isFree: true
      }
    }, {
      name: "Nike",
      logo: "https://upload.wikimedia.org/wikipedia/commons/a/a6/Logo_NIKE.svg",
      url: "#",
      price: "$89.99",
      rating: {
        score: 4.8,
        totalReviews: 1234
      },
      delivery: {
        type: "Standard",
        estimatedDays: "3-5 days",
        isFree: false
      }
    }]
                    },
                    {
                        id: 2,
                        name: "Black",
                        images: [
                            { url: "https://images.unsplash.com/photo-1491553895911-0055eca6402d?ixlib=rb-4.0.3", alt: "Black sneaker front view" },
                            { url: "https://images.unsplash.com/photo-1607522370275-f14206abe5d3?ixlib=rb-4.0.3", alt: "Black sneaker side view" },
                            { url: "https://images.unsplash.com/photo-1608231387042-66d1773070a5?ixlib=rb-4.0.3", alt: "Black sneaker back view" }
                        ],
                        affiliateLinks: [{
      name: "Amazon",
      logo: "https://upload.wikimedia.org/wikipedia/commons/4/4a/Amazon_icon.svg",
      url: "#",
      price: "$99.99",
      rating: {
        score: 4.5,
        totalReviews: 2543
      },
      delivery: {
        type: "Prime",
        estimatedDays: "2-3 days",
        isFree: true
      }
    }, {
      name: "Nike",
      logo: "https://upload.wikimedia.org/wikipedia/commons/a/a6/Logo_NIKE.svg",
      url: "#",
      price: "$89.99",
      rating: {
        score: 4.8,
        totalReviews: 1234
      },
      delivery: {
        type: "Standard",
        estimatedDays: "3-5 days",
        isFree: false
      }
    }]
                    }
                ]
            },
            {
                id: 2,
                name: "Classic Leather Sneakers",
                variants: [
                    {
                        id: 1,
                        name: "White",
                        images: [
                            { url: "https://images.unsplash.com/photo-1600269452121-4f2416e55c28?ixlib=rb-4.0.3", alt: "White sneaker front view" },
                            { url: "https://images.unsplash.com/photo-1595950653106-6c9ebd614d3a?ixlib=rb-4.0.3", alt: "White sneaker side view" },
                            { url: "https://images.unsplash.com/photo-1603808033192-082d6919d3e1?ixlib=rb-4.0.3", alt: "White sneaker back view" }
                        ],
                        affiliateLinks: [{
      name: "Amazon",
      logo: "https://upload.wikimedia.org/wikipedia/commons/4/4a/Amazon_icon.svg",
      url: "#",
      price: "$99.99",
      rating: {
        score: 4.5,
        totalReviews: 2543
      },
      delivery: {
        type: "Prime",
        estimatedDays: "2-3 days",
        isFree: true
      }
    }, {
      name: "Nike",
      logo: "https://upload.wikimedia.org/wikipedia/commons/a/a6/Logo_NIKE.svg",
      url: "#",
      price: "$89.99",
      rating: {
        score: 4.8,
        totalReviews: 1234
      },
      delivery: {
        type: "Standard",
        estimatedDays: "3-5 days",
        isFree: false
      }
    }]
                    },
                    {
                        id: 2,
                        name: "Black",
                        images: [
                            { url: "https://images.unsplash.com/photo-1491553895911-0055eca6402d?ixlib=rb-4.0.3", alt: "Black sneaker front view" },
                            { url: "https://images.unsplash.com/photo-1607522370275-f14206abe5d3?ixlib=rb-4.0.3", alt: "Black sneaker side view" },
                            { url: "https://images.unsplash.com/photo-1608231387042-66d1773070a5?ixlib=rb-4.0.3", alt: "Black sneaker back view" }
                        ],
                        affiliateLinks: [{
      name: "Amazon",
      logo: "https://upload.wikimedia.org/wikipedia/commons/4/4a/Amazon_icon.svg",
      url: "#",
      price: "$99.99",
      rating: {
        score: 4.5,
        totalReviews: 2543
      },
      delivery: {
        type: "Prime",
        estimatedDays: "2-3 days",
        isFree: true
      }
    }, {
      name: "Nike",
      logo: "https://upload.wikimedia.org/wikipedia/commons/a/a6/Logo_NIKE.svg",
      url: "#",
      price: "$89.99",
      rating: {
        score: 4.8,
        totalReviews: 1234
      },
      delivery: {
        type: "Standard",
        estimatedDays: "3-5 days",
        isFree: false
      }
    }]
                    }
                ]
            },
            {
                id: 3,
                name: "Classic Leather Sneakers",
                variants: [
                    {
                        id: 1,
                        name: "White",
                        images: [
                            { url: "https://images.unsplash.com/photo-1600269452121-4f2416e55c28?ixlib=rb-4.0.3", alt: "White sneaker front view" },
                            { url: "https://images.unsplash.com/photo-1595950653106-6c9ebd614d3a?ixlib=rb-4.0.3", alt: "White sneaker side view" },
                            { url: "https://images.unsplash.com/photo-1603808033192-082d6919d3e1?ixlib=rb-4.0.3", alt: "White sneaker back view" }
                        ],
                        affiliateLinks: [{
      name: "Amazon",
      logo: "https://upload.wikimedia.org/wikipedia/commons/4/4a/Amazon_icon.svg",
      url: "#",
      price: "$99.99",
      rating: {
        score: 4.5,
        totalReviews: 2543
      },
      delivery: {
        type: "Prime",
        estimatedDays: "2-3 days",
        isFree: true
      }
    }, {
      name: "Nike",
      logo: "https://upload.wikimedia.org/wikipedia/commons/a/a6/Logo_NIKE.svg",
      url: "#",
      price: "$89.99",
      rating: {
        score: 4.8,
        totalReviews: 1234
      },
      delivery: {
        type: "Standard",
        estimatedDays: "3-5 days",
        isFree: false
      }
    }]
                    },
                    {
                        id: 2,
                        name: "Black",
                        images: [
                            { url: "https://images.unsplash.com/photo-1491553895911-0055eca6402d?ixlib=rb-4.0.3", alt: "Black sneaker front view" },
                            { url: "https://images.unsplash.com/photo-1607522370275-f14206abe5d3?ixlib=rb-4.0.3", alt: "Black sneaker side view" },
                            { url: "https://images.unsplash.com/photo-1608231387042-66d1773070a5?ixlib=rb-4.0.3", alt: "Black sneaker back view" }
                        ],
                        affiliateLinks: [{
      name: "Amazon",
      logo: "https://upload.wikimedia.org/wikipedia/commons/4/4a/Amazon_icon.svg",
      url: "#",
      price: "$99.99",
      rating: {
        score: 4.5,
        totalReviews: 2543
      },
      delivery: {
        type: "Prime",
        estimatedDays: "2-3 days",
        isFree: true
      }
    }, {
      name: "Nike",
      logo: "https://upload.wikimedia.org/wikipedia/commons/a/a6/Logo_NIKE.svg",
      url: "#",
      price: "$89.99",
      rating: {
        score: 4.8,
        totalReviews: 1234
      },
      delivery: {
        type: "Standard",
        estimatedDays: "3-5 days",
        isFree: false
      }
    }]
                    }
                ]
            },
            {
                id: 4,
                name: "Classic Leather Sneakers",
                variants: [
                    {
                        id: 1,
                        name: "White",
                        images: [
                            { url: "https://images.unsplash.com/photo-1600269452121-4f2416e55c28?ixlib=rb-4.0.3", alt: "White sneaker front view" },
                            { url: "https://images.unsplash.com/photo-1595950653106-6c9ebd614d3a?ixlib=rb-4.0.3", alt: "White sneaker side view" },
                            { url: "https://images.unsplash.com/photo-1603808033192-082d6919d3e1?ixlib=rb-4.0.3", alt: "White sneaker back view" }
                        ],
                        affiliateLinks: [{
      name: "Amazon",
      logo: "https://upload.wikimedia.org/wikipedia/commons/4/4a/Amazon_icon.svg",
      url: "#",
      price: "$99.99",
      rating: {
        score: 4.5,
        totalReviews: 2543
      },
      delivery: {
        type: "Prime",
        estimatedDays: "2-3 days",
        isFree: true
      }
    }, {
      name: "Nike",
      logo: "https://upload.wikimedia.org/wikipedia/commons/a/a6/Logo_NIKE.svg",
      url: "#",
      price: "$89.99",
      rating: {
        score: 4.8,
        totalReviews: 1234
      },
      delivery: {
        type: "Standard",
        estimatedDays: "3-5 days",
        isFree: false
      }
    }]
                    },
                    {
                        id: 2,
                        name: "Black",
                        images: [
                            { url: "https://images.unsplash.com/photo-1491553895911-0055eca6402d?ixlib=rb-4.0.3", alt: "Black sneaker front view" },
                            { url: "https://images.unsplash.com/photo-1607522370275-f14206abe5d3?ixlib=rb-4.0.3", alt: "Black sneaker side view" },
                            { url: "https://images.unsplash.com/photo-1608231387042-66d1773070a5?ixlib=rb-4.0.3", alt: "Black sneaker back view" }
                        ],
                        affiliateLinks: [{
      name: "Amazon",
      logo: "https://upload.wikimedia.org/wikipedia/commons/4/4a/Amazon_icon.svg",
      url: "#",
      price: "$99.99",
      rating: {
        score: 4.5,
        totalReviews: 2543
      },
      delivery: {
        type: "Prime",
        estimatedDays: "2-3 days",
        isFree: true
      }
    }, {
      name: "Nike",
      logo: "https://upload.wikimedia.org/wikipedia/commons/a/a6/Logo_NIKE.svg",
      url: "#",
      price: "$89.99",
      rating: {
        score: 4.8,
        totalReviews: 1234
      },
      delivery: {
        type: "Standard",
        estimatedDays: "3-5 days",
        isFree: false
      }
    }]
                    }
                ]
            }
        ];

        const appContainer = document.getElementById('app');
        let selectedVariants = productsData.reduce(
            (acc, product) => ({
                ...acc,
                [product.id]: { variant: product.variants[0], currentIndex: 0 }
            }),
            {}
        );

        function handleVariantSelect(productId, variantId) {
            const product = productsData.find(p => p.id === productId);
            const variant = product.variants.find(v => v.id === variantId);
            selectedVariants[productId] = { variant, currentIndex: 0 };
            renderApp();
        }

        function renderApp() {
            appContainer.innerHTML = `
                <div class="min-h-full w-full bg-white p-4 md:p-6">
                    <div class="mx-auto max-w-7xl">
                        <div class="grid gap-8 sm:grid-cols-1 lg:grid-cols-2 xl:grid-cols-3">
                            ${productsData.map(product => `
                                <div class="border rounded-xl p-4 bg-white shadow-sm">
                                    <h2 class="mb-4 text-xl font-bold">${product.name}</h2>
                                    <div class="space-y-4">
                                        <div id="gallery-${product.id}">
                                            ${createImageGalleryHTML(product.id)}
                                        </div>
                                        <div class="flex gap-2 overflow-x-auto">
                                            ${product.variants.map(variant => `
                                                <button onclick="handleVariantSelect(${product.id}, ${variant.id})" class="flex-none ${
                                                    selectedVariants[product.id].variant.id === variant.id ? "ring-2 ring-black" : ""
                                                }">
                                                    <img src="${variant.images[0].url}" alt="${variant.name}" class="h-16 w-16 rounded-md object-cover object-center" />
                                                </button>
                                            `).join('')}
                                        </div>
                                    </div>
                                     <div>
                                        ${createAffiliateLinkHTML(product.id)}
                                    </div>
                                 </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        function formatReviewCount(count) {
            if (count >= 1000000) {
                return `${(count / 1000000).toFixed(1)}M`;
            }
            if (count >= 1000) {
                return `${(count / 1000).toFixed(1)}k`;
            }
            return count;
        }

        function renderStars(rating) {
            return Array.from({ length: 5 }, (_, index) => {
                const fullStars = Math.floor(rating);
                const partialFill = rating - fullStars;
                const currentStarFill = index === fullStars ? partialFill * 100 : 0;
                const isFullStar = index < fullStars;
                const isPartialStar = index === fullStars && partialFill > 0;
                
                return `
                    <svg class="h-4 w-4 ${isFullStar || isPartialStar ? "text-yellow-400" : "text-gray-300"}" 
                         viewBox="0 0 24 24" 
                         fill="${isFullStar ? "currentColor" : "none"}"
                         stroke="currentColor">
                        ${isPartialStar ? `
                            <defs>
                                <linearGradient id="partial-${index}">
                                    <stop offset="${currentStarFill}%" stop-color="currentColor" />
                                    <stop offset="${currentStarFill}%" stop-color="transparent" />
                                </linearGradient>
                            </defs>
                        ` : ''}
                        <path stroke-linecap="round" 
                              stroke-linejoin="round" 
                              stroke-width="2"
                              fill="${isPartialStar ? `url(#partial-${index})` : ''}"
                              d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                    </svg>
                `;
            }).join('');
        }

        function createAffiliateLinkHTML(productId) {
            const product = productsData.find(p => p.id === productId);
            const AffiliateLink = product.variants.find(v => v.id === selectedVariants[productId].variant.id).affiliateLinks;

            return `
                <h3 class="mb-3 font-semibold">Available From</h3>
                <div class="space-y-3">
                    ${AffiliateLink.map(link => `
                        <a href="${link.url}" target="_blank" rel="noopener noreferrer" class="flex flex-col w-full rounded-lg border p-3 hover:bg-gray-50 space-y-2">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <img src="${link.logo}" alt="${link.name}" class="h-8 w-8 object-contain" />
                                    <span class="font-medium">${link.name}</span>
                                </div>
                                <span class="font-semibold">${link.price}</span>
                            </div>
                            <div class="flex items-center justify-between text-sm">
                                <div class="flex items-center gap-1">
                                    <div class="flex items-center">
                                        ${renderStars(link.rating.score)}
                                    </div>
                                    <span class="text-gray-600">
                                        (${formatReviewCount(link.rating.totalReviews)} reviews)
                                    </span>
                                </div>
                                <div class="flex items-center gap-3 text-gray-600">
                                    <div class="flex items-center gap-1">
                                        <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M5 13l4 4L19 7"></path>
                                        </svg>
                                        <span>
                                            ${link.delivery.isFree ? "Free delivery" : link.delivery.type}
                                        </span>
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <path d="M12 6v6l4 2"></path>
                                        </svg>
                                        <span>${link.delivery.estimatedDays}</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    `).join('')}
                </div>
            `;
        }

        function createImageGalleryHTML(productId) {
            const { variant, currentIndex } = selectedVariants[productId];
            const images = variant.images;

            const indicatorsHTML = images.map((_, index) => `
                <button class="w-2 h-2 rounded-full transition-all ${currentIndex === index ? "bg-black" : "bg-gray-300"}"
                        aria-label="Go to image ${index + 1}" onclick="updateGallery(${productId}, ${index})">
                </button>
            `).join('');

            return `
                <div class="relative w-full" style="aspect-ratio:1/1">
                    <div class="relative aspect-square overflow-hidden rounded-lg bg-gray-100">
                        <img src="${images[currentIndex].url}" alt="${images[currentIndex].alt}" class="h-full w-full object-cover object-center" />
                        <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex items-center gap-2">${indicatorsHTML}</div>
                        <button class="absolute left-2 top-1/2 transform -translate-y-1/2 bg-white p-2 rounded-full" aria-label="Previous"
                                onclick="prevImage(${productId})">&#9664;</button>
                        <button class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-white p-2 rounded-full" aria-label="Next"
                                onclick="nextImage(${productId})">&#9654;</button>
                    </div>
                </div>
            `;
        }

        function updateGallery(productId, index) {
            selectedVariants[productId].currentIndex = index;
            document.getElementById(`gallery-${productId}`).innerHTML = createImageGalleryHTML(productId);
        }

        function prevImage(productId) {
            const variantData = selectedVariants[productId];
            variantData.currentIndex = (variantData.currentIndex - 1 + variantData.variant.images.length) % variantData.variant.images.length;
            updateGallery(productId, variantData.currentIndex);
        }

        function nextImage(productId) {
            const variantData = selectedVariants[productId];
            variantData.currentIndex = (variantData.currentIndex + 1) % variantData.variant.images.length;
            updateGallery(productId, variantData.currentIndex);
        }

        renderApp();
    </script>
</body>
</html>
